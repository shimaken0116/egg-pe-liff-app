# プロジェクトダッシュボード：LINEリマインド自動化システム

## 1. プロジェクト概要
LINE LiffとGoogleフォームを連携させ、会員へのリマインドメッセージ送信を自動化するシステム。

## 2. 現在の作業フォーカス
**Googleフォームを活用したLINEリマインド自動化システムの再構築とセキュリティ強化**

## 3. 主要コンポーネントと関連ファイル
- **LINE LIFFアプリ**: `index.html`
  - ユーザーのLINE IDトークンを取得し、Googleフォームへリダイレクトする。
- **Googleフォーム**: ユーザーからの情報収集インターフェース。LIFFアプリからIDトークンを受け取る。
- **Google Apps Script (GAS)**: `src/gas/onFormSubmit.js`, `src/gas/firestore_test.js`
  - Googleフォームの送信トリガーで実行され、IDトークン検証、LINEメッセージ送信、Firestoreへのデータ保存を担当。
- **Googleスプレッドシート**: フォーム回答の一次データストア。
- **Firestore**: フォーム回答の永続的なデータストア。

## 4. 最近の進捗
- Googleフォームを再活用する方針に転換。
- `index.html` を修正し、LIFFアプリからGoogleフォームへIDトークン全体をURLパラメータとして渡すように変更。
- `src/gas/onFormSubmit.js` にIDトークン検証ロジックを追加し、なりすまし防止を強化。
- `src/gas/web_app.js` を削除（不要になったため）。
- `src/gas/onFormSubmit.js` 内の`saveFormDataToFirestore`関数の定義位置を修正し、Firestoreへのデータ保存が正常に動作することを確認。
- **システムテスト完了**: LINEメッセージ送信、Firestoreへのデータ保存が正常に行われることを確認済み。

## 5. 今後の課題と次のステップ

### フェーズ1: Googleフォーム運用と機能拡張

1.  **Googleフォームの運用**: 毎月のレッスンごとに新しいGoogleフォームを作成し、`index.html`の`GOOGLE_FORM_BASE_URL`を更新する運用フローを確立。
2.  **Firestoreセキュリティルールの強化**:
    *   テストが完了し、システムが安定稼働する目処が立ったら、Firestoreのセキュリティルールを「テストモード」から本番運用に適したルールに強化する。
3.  **LINEメッセージ送信機能の拡張**:
    *   リマインドメッセージのスケジュール送信機能（例: レッスン前日に自動送信）の検討。
    *   メッセージ内容のテンプレート化や管理機能の検討。

### フェーズ2: 長期的なセキュリティと運用改善の検討

1.  **IDトークンのURL露出リスクの再評価**: Googleフォームの「フォームごとのURL」という利便性を維持しつつ、IDトークンがURLに露出するリスクをさらに低減する代替案（例: 短期的なワンタイムトークン利用など）の検討。
2.  **フォーム作成の自動化/効率化**: GoogleフォームのAPI利用や、GASによるフォーム自動生成など、毎月のフォーム作成作業を効率化する仕組みの検討。
